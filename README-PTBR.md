# FastAPI API Key Authentication

[![Python](https://img.shields.io/badge/python-3.13-blue.svg?logo=python\&logoColor=white)](#-requisitos)
[![FastAPI](https://img.shields.io/badge/fastapi-0.115.13-green.svg?logo=fastapi\&logoColor=white)](#-principais-tecnologias-utilizadas)
[![Docker](https://img.shields.io/badge/docker-ready-blue.svg?logo=docker\&logoColor=white)](https://www.docker.com/)
[![Build](https://img.shields.io/badge/build-passing-brightgreen.svg?logo=github\&logoColor=white)](#-como-executar-o-projeto-localmente)
[![Docs](https://img.shields.io/badge/docs-Swagger-informational.svg?logo=swagger\&logoColor=white)](#-endpoints-dispon√≠veis)

> **Exemplo de aplica√ß√£o FastAPI com autentica√ß√£o por chave de API ‚Äì Template de Backend em Python**

**FastAPI API Key Authentication** √© um projeto *template* (modelo) de backend **100% em Python** que demonstra como implementar autentica√ß√£o simples via **chave de API** em uma API REST criada com FastAPI. Seguindo princ√≠pios de **Clean Architecture** e **Domain-Driven Design (DDD)**, o projeto fornece uma base estrutural moderna para aplica√ß√µes seguras e escal√°veis.

Destinado a desenvolvedores de n√≠vel **iniciante √† avan√ßado**, o template oferece:

* **Seguran√ßa pronta**: autentica√ß√£o por chave de API (via header customiz√°vel) j√° integrada em todas as rotas protegidas.
* **Arquitetura organizada**: separa√ß√£o clara entre camadas *core* (infraestrutura) e *m√≥dulos de dom√≠nio*, facilitando manuten√ß√£o e expans√£o.
* **Documenta√ß√£o autom√°tica**: interface Swagger (OpenAPI) dispon√≠vel para testar e integrar rapidamente os endpoints.
* **Boas pr√°ticas incorporadas**: uso de Pydantic v2 para valida√ß√£o, logging estruturado (Loguru), respostas padronizadas e pr√©-configura√ß√£o para Docker e testes.

A seguir voc√™ encontrar√° um guia completo de instala√ß√£o, uso e contribui√ß√£o. Boa leitura!

---

## üìë Sum√°rio

* [1. Descri√ß√£o Geral](#-descri√ß√£o-geral)

  * [1.1 O que ele faz üöÄ](#o-que-ele-faz-)
  * [1.2 Problema que resolve üí°](#problema-que-resolve)
  * [1.3 P√∫blico-alvo üéØ](#p√∫blicoalvo-)
  * [1.4 Destaques üî•](#destaques)
* [2. Principais Funcionalidades](#-principais-funcionalidades)
* [3. Principais Tecnologias Utilizadas](#-principais-tecnologias-utilizadas)
* [4. Estrutura do Projeto](#-estrutura-do-projeto)
* [5. Estrutura das Depend√™ncias](#-estrutura-das-depend√™ncias)
* [6. Requisitos](#-requisitos)

  * [6.1 Software & Ferramentas](#-software--ferramentas)
  * [6.2 Depend√™ncias de Projeto](#-depend√™ncias-de-projeto)
* [7. Como executar o projeto localmente](#-como-executar-o-projeto-localmente)

  * [7.1 Caminho A ‚Äî Ambiente local com uv (recomendado)](#caminho-a--ambiente-local-com-uv-recomendado)
  * [7.2 Caminho B ‚Äî Docker / Docker Compose](#caminho-b--docker--docker-compose)
* [8. Endpoints Dispon√≠veis](#-endpoints-dispon√≠veis)

  * [8.1 Autentica√ß√£o](#-autentica√ß√£o)
  * [8.2 Vis√£o Geral](#-vis√£o-geral)
  * [8.3 POST /api/v1/example/ ‚Äî Exemplo de Opera√ß√£o](#1-post-apiv1example--exemplo-de-opera√ß√£o)
  * [8.4 GET /healthz ‚Äî Health Check](#2-get-healthz--health-check)
  * [8.5 GET / ‚Äî Redirect para /docs](#3-get--redirect-para-docs)
  * [8.6 GET /docs & /redoc ‚Äî Documenta√ß√£o](#4-get-docs--redoc--documenta√ß√£o)
* [9. Perguntas Frequentes (FAQ)](#-perguntas-frequentes-faq)
* [10. Como contribuir](#-como-contribuir)

  * [10.1 Fluxo de contribui√ß√£o](#-fluxo-de-contribui√ß√£o)
  * [10.2 Padr√µes de Branches & Commits](#-padr√µes-de-branches--commits)
  * [10.3 Qualidade de C√≥digo e Estilo](#-qualidade-de-c√≥digo-e-estilo)
  * [10.4 Vari√°veis de Ambiente & Segredos](#-vari√°veis-de-ambiente--segredos)
  * [10.5 Pull Requests (PRs)](#-pull-requests-prs)
  * [10.6 Checklist antes de abrir o PR](#-checklist-antes-de-abrir-o-pr)
* [11. Licen√ßa](#-licen√ßa)
* [12. Autores](#-autores)

---

## üìù Descri√ß√£o Geral

**FastAPI API Key Authentication** √© um aplicativo de exemplo criado para mostrar na pr√°tica como proteger endpoints de uma API **FastAPI** usando uma chave de API (*API Key*). Ele atua como um ponto de partida para desenvolver **microservi√ßos** ou **APIs internas** que precisam de uma camada simples de autentica√ß√£o sem implementar todo o fluxo de OAuth2 ou JWT.

### O que ele faz üöÄ

1. **Valida** todas as requisi√ß√µes recebidas nos endpoints protegidos, assegurando que possuam um cabe√ßalho de **API Key** v√°lido antes de processar a l√≥gica de neg√≥cio.
2. **Exemplifica** uma estrutura de projeto organizada em camadas (Clean Architecture), servindo como modelo para cria√ß√£o de novos endpoints e m√≥dulos de forma desacoplada.
3. **Fornece** respostas padronizadas em formato JSON, incluindo metadados (c√≥digo HTTP, caminho, timestamp), tanto para sucessos quanto erros, facilitando o consumo e a depura√ß√£o.
4. **Documenta** automaticamente a API utilizando o **Swagger UI** do FastAPI (interface interativa dispon√≠vel em `/docs`), permitindo testar as rotas com rapidez.
5. **Inclui** utilit√°rios prontos para produ√ß√£o, como um endpoint de *health check* (`/healthz`) para monitoramento e configura√ß√£o f√°cil de vari√°veis de ambiente via arquivo `.env`.

### Problema que resolve üí°

Muitas aplica√ß√µes web precisam expor APIs de forma r√°pida e segura, seja para consumo interno entre microservi√ßos ou para disponibilizar servi√ßos a clientes externos. Implementar do zero um esquema de autentica√ß√£o simples pode levar a erros de seguran√ßa (por exemplo, verifica√ß√µes vulner√°veis a *timing attacks*) ou a uma arquitetura desestruturada conforme o projeto cresce.

Este template resolve esses desafios ao:

* **Oferecer uma solu√ß√£o de autentica√ß√£o minimalista** (via API Key) pronta para uso, evitando a necessidade de configurar OAuth2 ou outros m√©todos quando n√£o necess√°rios.
* **Estabelecer uma base de c√≥digo organizada**, facilitando a evolu√ß√£o do projeto com m√≥dulos bem definidos sem misturar regras de neg√≥cio com detalhes de infra.
* **Garantir seguran√ßa b√°sica** ao usar compara√ß√£o de strings de forma segura (`secrets.compare_digest`) e retornos consistentes de erro (c√≥digo 401 com headers adequados), alinhados com as melhores pr√°ticas HTTP.

### P√∫blico-alvo üéØ

| Perfil de Usu√°rio                      | O que ganha com o projeto                                                                                                                     |
|----------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------|
| **Desenvolvedores Backend**            | Um ponto de partida coeso para criar novas APIs j√° estruturadas e seguras com API Key.                                                        |
| **Equipes de APIs Internas**           | Um modelo consistente para padronizar a autentica√ß√£o entre microservi√ßos e garantir que apenas servi√ßos autorizados acessem dados sens√≠veis.  |
| **Iniciantes em FastAPI**              | Um exemplo pr√°tico de como organizar um projeto FastAPI complexo (v√°rias camadas) de forma limpa, com autentica√ß√£o e documenta√ß√£o integradas. |
| **Tech Leads / Arquiteto de Software** | Um blueprint de refer√™ncia para disseminar boas pr√°ticas de estrutura√ß√£o de projetos Python e implanta√ß√£o de medidas de seguran√ßa simples.    |

### Destaques üî•

* **F√°cil de Customizar**: Nome do cabe√ßalho da API Key e o pr√≥prio valor da chave s√£o definidos via `.env`, permitindo adapta√ß√£o r√°pida a diferentes ambientes ou pol√≠ticas de seguran√ßa.
* **Middleware de Autentica√ß√£o Global**: Todas as rotas (exceto as explicitamente p√∫blicas) podem ser protegidas de uma s√≥ vez usando depend√™ncias globais ou middleware ‚Äì simplificando a extens√£o da seguran√ßa a novos endpoints.
* **Retorno Padr√£o Unificado**: Implementa√ß√£o de um modelo de resposta consistente (`StandardResponse`), que envelopa os dados de resposta do usu√°rio junto com metadados (status, m√©todo, etc.), facilitando logs e monitoramento.
* **Pronto para Docker**: Arquivos *Dockerfile* e *docker-compose* fornecidos para execu√ß√£o conteinerizada, agilizando testes locais e deploys em ambientes padronizados.
* **Desenvolvimento √Ågil**: Suporte a *hot-reload* em ambiente de desenvolvimento (via Uvicorn ou FastAPI CLI) e configura√ß√£o de lint/format predefinida (Ruff), garantindo feedback r√°pido durante o desenvolvimento e c√≥digo consistente.
* **Pronto para Testes**: Estrutura de testes automatizados configurada (Pytest) para facilitar a cria√ß√£o de testes unit√°rios e de integra√ß√£o, ajudando a manter a qualidade do c√≥digo √† medida que o projeto cresce.

## ‚öôÔ∏è Principais Funcionalidades

| #     | Funcionalidade               | O que faz                                                                                                                                             | Diferenciais t√©cnicos / de usabilidade                                                                                                                                                 |
|-------|------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **1** | **Autentica√ß√£o via API Key** | Restringe o acesso √† API √†s requisi√ß√µes que apresentam a chave correta no cabe√ßalho.                                                                  | üîê Verifica√ß√£o segura utilizando `secrets.compare_digest` para prevenir *timing attacks*. Header customiz√°vel (padr√£o: **X-API-Key**).                                                 |
| **2** | **Endpoint de Exemplo**      | Fornece uma rota exemplificativa (e.g., `/api/v1/example/`) que pode servir de modelo para implementar novas funcionalidades.                         | üõ†Ô∏è Demonstra a aplica√ß√£o pr√°tica do padr√£o **Clean Architecture** (camada de *domain*, *use case* e *presentation*) e uso de **Pydantic** para valida√ß√£o de dados.                    |
| **3** | **Health Check**             | Exp√µe um endpoint p√∫blico `/healthz` para verifica√ß√£o r√°pida da sa√∫de do servi√ßo (usado em monitoramento de orquestradores, Kubernetes, etc.).        | ‚ù§Ô∏è Segue o padr√£o 12-Factor App; pode ser facilmente integrado a *load balancers* ou sistemas de monitoramento de uptime.                                                              |
| **4** | **Documenta√ß√£o Interativa**  | Disponibiliza a documenta√ß√£o Swagger/OpenAPI via interface web em `/docs` (Swagger UI) e `/redoc` (ReDoc).                                            | üìñ Permite testar chamadas √† API diretamente pelo navegador, incluindo inserir a API Key na interface do Swagger (bot√£o **Authorize**).                                                |
| **5** | **Respostas Padronizadas**   | Todas as respostas de sucesso ou erro seguem um schema unificado (`code`, `method`, `path`, `timestamp`, `details{...}`), independentemente da rota.  | üìä Facilita a estrutura√ß√£o de logs e auditoria; clientes e desenvolvedores t√™m um formato consistente de resposta para tratar.                                                         |
| **6** | **Logging Estruturado**      | Registro de logs de cada requisi√ß√£o com informa√ß√µes importantes (tempo de execu√ß√£o, status, origem) e identifica√ß√£o de requisi√ß√£o via `X-Request-ID`. | üìë Baseado em **Loguru** para sa√≠da em JSON; facilita integra√ß√£o com ferramentas de observabilidade (ELK, Graylog etc.) e depura√ß√£o de erros com *stack traces* limpos (Stackprinter). |

---

## üß∞ Principais Tecnologias Utilizadas

| Tecnologia              | Vers√£o          | Papel no Projeto                                                                     | Por que foi escolhida?                                                                                                                      |
|-------------------------|-----------------|--------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------|
| **Python**              | 3.13            | Linguagem principal; suporte a c√≥digo ass√≠ncrono nativo.                             | Ecossistema vasto e sintaxe simples, al√©m de performance melhorada a cada vers√£o.                                                           |
| **FastAPI**             | 0.115.13        | Framework web ASGI para constru√ß√£o de APIs REST.                                     | Performance alt√≠ssima (compar√°vel a Node.js e Go) e gera√ß√£o autom√°tica de documenta√ß√£o (Swagger UI).                                        |
| **Pydantic v2**         | 2.11.7          | Modelagem e valida√ß√£o de dados (models de request/response, configs).                | Valida√ß√µes declarativas e r√°pidas (core em Rust), garantindo dados confi√°veis na API.                                                       |
| **Uvicorn & Hypercorn** | 0.34.x / 0.17.3 | Servidores ASGI para rodar a aplica√ß√£o (Uvicorn no dev, Hypercorn opcional p/ prod). | Suporte a recursos modernos (HTTP/2, WebSockets); prov√™ hot-reload em desenvolvimento e alta performance em produ√ß√£o.                       |
| **Orjson**              | 3.11.0          | Serializa√ß√£o JSON ultrarr√°pida para respostas HTTP.                                  | At√© 3x mais r√°pido que a biblioteca padr√£o de JSON do Python, melhorando a lat√™ncia da API.                                                 |
| **Loguru**              | 0.7.3           | Logging simples e estruturado.                                                       | API de logging amig√°vel, suporta formata√ß√£o por request e ‚Äúsinks‚Äù flex√≠veis (console, arquivo, etc.).                                       |
| **Pydantic Settings**   | 2.10.1          | Leitura de configura√ß√µes e segredos via arquivo `.env` ou vari√°veis de ambiente.     | Facilita a aplica√ß√£o do *12-Factor*: configura√ß√£o externa ao c√≥digo, com parsing autom√°tico de tipos.                                       |
| **Pytest**              | 8.4.1 (dev)     | Framework de testes.                                                                 | Escrita de testes concisa com fixtures; suporte a testes ass√≠ncronos (asyncio) para cobrir fun√ß√µes FastAPI facilmente.                      |
| **Ruff**                | 0.12.0 (dev)    | Linter e formatter de c√≥digo Python.                                                 | Combina dezenas de verificadores (Flake8, Black, etc.) em uma s√≥ ferramenta extremamente r√°pida, garantindo padr√µes de c√≥digo consistentes. |

> üîí **Seguran√ßa de Depend√™ncias:** Todas as vers√µes est√£o fixadas em `requirements.txt` e `uv.lock` para builds reproduz√≠veis. Al√©m disso, apenas bibliotecas essenciais s√£o inclu√≠das para minimizar a superf√≠cie de ataque e reduzir impactos em desempenho.

## üóÇÔ∏è Estrutura do Projeto

<details>
<summary><strong>üå≥¬†√Årvore de diret√≥rios (simplificada)</strong></summary>

```text
fastapi-apikey-authentication/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ app.py               # Inicializa√ß√£o da inst√¢ncia FastAPI e importa rotas
‚îÇ   ‚îú‚îÄ‚îÄ core/                # Funcionalidades "core" (infraestrutura e cross-cutting)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ security.py      # L√≥gica de autentica√ß√£o por API Key (Dependency)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ middleware.py    # Middleware de formata√ß√£o de resposta e logging
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ exception_handler.py  # Tratamento global de exce√ß√µes HTTP
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ settings.py      # Configura√ß√µes da aplica√ß√£o (Pydantic BaseSettings)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ schemas.py       # Schemas gen√©ricos reutiliz√°veis (ex: StandardResponse)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ exceptions.py    # Exce√ß√µes customizadas
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ logging.py       # Configura√ß√£o de logs (Loguru logger)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ resources.py     # Recursos diversos (ex: textos de erro ou constantes)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ utils.py         # Utilit√°rios gerais
‚îÇ   ‚îî‚îÄ‚îÄ modules/             # M√≥dulos de dom√≠nio (cada pasta √© um contexto isolado)
‚îÇ       ‚îú‚îÄ‚îÄ example/         # M√≥dulo de exemplo (funcionalidade de demonstra√ß√£o)
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ domain/      # Regras de neg√≥cio, entidades e mapeadores (se aplic√°vel)
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ application/ # Casos de uso (orquestra√ß√£o entre domain e presentation)
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ presentation/ # Interface (rotas FastAPI, schemas de request/response, docs)
‚îÇ       ‚îÇ       ‚îú‚îÄ‚îÄ routers.py       # Defini√ß√£o das rotas/endpoints do exemplo
‚îÇ       ‚îÇ       ‚îú‚îÄ‚îÄ schemas.py       # Schemas Pydantic para request/response do exemplo
‚îÇ       ‚îÇ       ‚îú‚îÄ‚îÄ dependencies.py  # Depend√™ncias (inje√ß√µes) espec√≠ficas do exemplo
‚îÇ       ‚îÇ       ‚îú‚îÄ‚îÄ docs.py          # Descri√ß√µes e exemplos (usado no OpenAPI) do m√≥dulo
‚îÇ       ‚îÇ       ‚îî‚îÄ‚îÄ exceptions.py    # Exce√ß√µes espec√≠ficas do dom√≠nio exemplo
‚îÇ       ‚îî‚îÄ‚îÄ health/          # M√≥dulo de health check (dom√≠nio de sistema)
‚îÇ           ‚îú‚îÄ‚îÄ application/ # (Poderia conter l√≥gica de verif. de subsistemas, se necess√°rio)
‚îÇ           ‚îî‚îÄ‚îÄ presentation/
‚îÇ               ‚îú‚îÄ‚îÄ routers.py       # Rota de health (`/healthz`)
‚îÇ               ‚îú‚îÄ‚îÄ schemas.py       # Schema de resposta de health (ex.: status)
‚îÇ               ‚îú‚îÄ‚îÄ docs.py          # Documenta√ß√£o do endpoint de health
‚îÇ               ‚îî‚îÄ‚îÄ exceptions.py    # (n/a - health dificilmente gera exce√ß√£o custom)
‚îú‚îÄ‚îÄ .env.example            # Exemplo de configura√ß√µes de ambiente (copiar para .env)
‚îú‚îÄ‚îÄ Dockerfile              # Receita para construir imagem Docker da aplica√ß√£o
‚îú‚îÄ‚îÄ docker-compose.yaml     # Define servi√ßo para execu√ß√£o local (inclui aplica√ß√£o)
‚îú‚îÄ‚îÄ pyproject.toml          # Metadados do projeto e depend√™ncias (PEP 621)
‚îú‚îÄ‚îÄ requirements.txt        # Lista de depend√™ncias fixadas (congeladas)
‚îú‚îÄ‚îÄ uv.lock                 # Lockfile de vers√µes das depend√™ncias (gerado pelo uv)
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îî‚îÄ‚îÄ directory_tree.py   # Script utilit√°rio para gerar a √°rvore de diret√≥rios
‚îú‚îÄ‚îÄ test/                   # Pasta para os testes (unit√°rios/integrados)
‚îÇ   ‚îú‚îÄ‚îÄ core/               # (Ex.: testes dos utilit√°rios core)
‚îÇ   ‚îî‚îÄ‚îÄ modules/            # (Ex.: testes de cada m√≥dulo de dom√≠nio)
‚îî‚îÄ‚îÄ README.md               # Documenta√ß√£o principal do reposit√≥rio
```

</details>

| Camada/Pasta            | Responsabilidade/Papel                                                                                       | Detalhes                                                                                                                                                                                                                                          |
|-------------------------|--------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **`app/app.py`**        | Inicializa a aplica√ß√£o FastAPI, configurando defini√ß√µes globais e incluindo as rotas de todos os m√≥dulos.    | ‚ÄúPonto de entrada‚Äù da aplica√ß√£o. Importa os routers de cada m√≥dulo e adiciona middlewares (como o de autentica√ß√£o global, se configurado).                                                                                                        |
| **`app/core/`**         | M√≥dulo n√∫cleo com componentes reutiliz√°veis e configura√ß√µes que permeiam todo o projeto.                     | Cont√©m l√≥gica de autentica√ß√£o, formata√ß√£o de resposta, captura de erros, defini√ß√£o de configura√ß√µes (12-Factor) e outros utilit√°rios independentes de regra de neg√≥cio.                                                                           |
| **`app/modules/`**      | Cada subpasta representa um **contexto de neg√≥cio** isolado (DDD).                                           | Permite evoluir o software adicionando novos dom√≠nios ou funcionalidades sem conflitar com existentes. Ex.: m√≥dulo **example** (did√°tico) e **health** (sist√™mico).                                                                               |
| **`.../presentation/`** | Camada de **apresenta√ß√£o**: onde est√£o os *controllers* da Clean Architecture (aqui, os routers do FastAPI). | Define endpoints, realiza valida√ß√£o inicial de dados via schemas Pydantic e retorna respostas usando as classes de modelo. Tamb√©m inclui descri√ß√µes (docs.py) exibidas no Swagger UI.                                                             |
| **`.../application/`**  | Camada de **aplica√ß√£o**: implementa os casos de uso ou *interactors*.                                        | Cont√©m a l√≥gica que orquestra chamadas entre a camada de apresenta√ß√£o e a de dom√≠nio. Ex.: no m√≥dulo example, poderia processar dados de entrada, chamar servi√ßos do dom√≠nio e formatar a resposta final.                                         |
| **`.../domain/`**       | Camada de **dom√≠nio**: regras de neg√≥cio, entidades e contrata√ß√£o de reposit√≥rios.                           | Idealmente independente de detalhes de infraestrutura. No m√≥dulo example, possui classes ou fun√ß√µes representando o core da l√≥gica de neg√≥cio do exemplo. Em templates mais completos, aqui ficam interfaces de reposit√≥rios e servi√ßos externos. |
| **Arquivos de config**  | (root) `Dockerfile`, `docker-compose.yaml`, etc.                                                             | Permitem conteineriza√ß√£o e execu√ß√£o consistente em diferentes ambientes.                                                                                                                                                                          |
| **`test/`**             | Su√≠te de testes automatizados (inicialmente exemplificada).                                                  | Facilita expans√£o da cobertura de testes conforme novas funcionalidades s√£o adicionadas. (Ex.: testes de autentica√ß√£o e do endpoint de exemplo).                                                                                                  |

> üß© **Nota:** A estrutura em camadas (presentation, application, domain) n√£o impede que um endpoint chame a l√≥gica diretamente, mas encoraja separa√ß√£o de conceitos. Para funcionalidades simples, a camada de aplica√ß√£o pode ser minimalista; j√° em casos complexos, esse padr√£o ajuda a manter o c√≥digo organizado.

---

## üß¨ Estrutura das Depend√™ncias

As depend√™ncias do projeto s√£o gerenciadas via **pyproject.toml** (PEP 621) e um *lockfile* (`uv.lock`) para consist√™ncia. Abaixo est√° a estrutura das principais bibliotecas utilizadas e seus subcomponentes:

```text
fastapi-apikey-authentication (template) v1.0.0
‚îú‚îÄ fastapi[standard] v0.115.13
‚îÇ   ‚îú‚îÄ pydantic v2.11.7
‚îÇ   ‚îú‚îÄ starlette v0.46.2
‚îÇ   ‚îú‚îÄ email-validator, python-multipart, httpx, jinja2... (extras do FastAPI)
‚îÇ   ‚îî‚îÄ uvicorn[standard] v0.34.3 (servidor web + reload) 
‚îú‚îÄ hypercorn v0.17.3          (servidor ASGI alternativo, ex. p/ HTTP/2)
‚îú‚îÄ loguru v0.7.3             (logging estruturado)
‚îú‚îÄ orjson v3.11.0            (serializa√ß√£o JSON de alta performance)
‚îú‚îÄ pydantic-settings v2.10.1 (gest√£o de configura√ß√µes com BaseSettings)
‚îú‚îÄ stackprinter v0.2.12      (formata√ß√£o de tracebacks de erro leg√≠veis)
‚îú‚îÄ pytest v8.4.1 [dev]       (framework de testes)
‚îî‚îÄ ruff v0.12.0 [dev]        (linter/formatter tudo-em-um)
```

**Observa√ß√µes:**

* Pacotes com `[dev]` est√£o inclu√≠dos apenas para desenvolvimento e n√£o s√£o necess√°rios em produ√ß√£o.
* O FastAPI √© instalado com o extra `[standard]`, que j√° traz ferramentas √∫teis como uvicorn (servidor) e outros utilit√°rios (email-validator, jinja2 para templates, etc.), facilitando prototipa√ß√£o.
* O arquivo `requirements.txt` √© gerado a partir do lockfile e fixa vers√µes exatas para cada depend√™ncia (garantindo que todos desenvolvedores/ambientes usem as mesmas vers√µes).
* N√£o h√° depend√™ncias externas de banco de dados ou autentica√ß√£o de terceiros ‚Äì a ideia √© manter o projeto simples. Caso seu caso de uso exija integra√ß√µes, elas podem ser adicionadas conforme a necessidade, mantendo a organiza√ß√£o modular.

---

## üßæ Requisitos

### üì¶ Software & Ferramentas

Para executar e desenvolver este projeto, assegure-se de ter:

| Item                     | Vers√£o / Observa√ß√£o                   |        Obrigat√≥rio?        | Descri√ß√£o / Uso                                                                                                                                                |
|--------------------------|---------------------------------------|:--------------------------:|----------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **Python**               | >= 3.13 (compat√≠vel com 3.13+)        |             ‚úÖ              | Interpretador Python para rodar a aplica√ß√£o. Vers√µes mais recentes garantem melhor performance e compatibilidade com Pydantic v2.                              |
| **uv** (CLI de deps)     | √öltima est√°vel (opcional)             |             ‚ö†Ô∏è             | Gerenciador de depend√™ncias/venv recomendado. Facilita criar ambientes virtuais e sincronizar o `uv.lock`. ([instala√ß√£o](https://astral.sh/uv/))               |
| **Git**                  | Qualquer vers√£o recente               |             ‚úÖ              | Controle de vers√£o para clonar o reposit√≥rio e gerenciar c√≥digo-fonte.                                                                                         |
| **Docker** + **Compose** | Docker Engine 20+ / Docker Compose 2+ | ‚úîÔ∏è (p/ deploy) ‚ö†Ô∏è (p/ dev) | Para executar em container (opcional no desenvolvimento, mas recomendado para garantir paridade de ambiente).                                                  |
| **Editor/IDE**           | VSCode, PyCharm, etc. (sugest√£o)      |             ‚úÖ              | Um bom editor auxilia na produtividade. Este projeto inclui configura√ß√£o de lint pronta (Ruff) que pode ser integrada ao seu editor para feedback instant√¢neo. |

*Observa√ß√£o:* O uso da ferramenta `uv` (da Astral) √© incentivado para simplificar o gerenciamento de ambientes e depend√™ncias (similar ao `pipenv` ou `poetry`). No entanto, voc√™ pode optar por usar *pip/venv* tradicionais se preferir ‚Äì basta seguir o `requirements.txt` manualmente.

### üîß Depend√™ncias de Projeto

* **Principais Bibliotecas:** J√° listadas na se√ß√£o anterior (FastAPI, Pydantic, etc.). Todas elas s√£o instaladas via `pip` ou `uv` a partir do `pyproject.toml`.
* **Bibliotecas de Desenvolvimento:** Incluem `pytest` (para executar os testes) e `ruff` (para lint/format). Estes n√£o s√£o necess√°rios para rodar a aplica√ß√£o em produ√ß√£o, mas s√£o recomendados durante o ciclo de desenvolvimento para manter a qualidade do c√≥digo.
* **Servi√ßos Externos:** N√£o h√° consumo de servi√ßos externos nesta aplica√ß√£o. A autentica√ß√£o √© feita localmente comparando a chave enviada com a chave configurada nas vari√°veis de ambiente. Se necess√°rio, a integra√ß√£o com bancos de dados ou APIs externas pode ser adicionada em novos m√≥dulos, seguindo o padr√£o do template.

### üñ•Ô∏è Configura√ß√£o de Ambiente

* **Vari√°veis de Ambiente:** Renomeie o arquivo `.env.example` para `.env` e ajuste os valores conforme sua necessidade. Os principais par√¢metros incluem:

  * `SECURITY_API_KEY_HEADER` ‚Äì Nome do cabe√ßalho que transportar√° a API Key (padr√£o: `X-API-Key`).
  * `SECURITY_API_KEY` ‚Äì O valor secreto da API Key que deve ser aceito. (Defina um valor forte em produ√ß√£o; no arquivo de exemplo h√° um placeholder para desenvolvimento).
  * Outros par√¢metros: (p.ex. `LOG_LEVEL`, `APP_ENV`) conforme definidos em `core/settings.py`, que podem alterar comportamentos de log ou configura√ß√µes espec√≠ficas do ambiente.
* **Porta da Aplica√ß√£o:** Por padr√£o, a aplica√ß√£o roda na porta **8000** (ver `docker-compose.yaml` e instru√ß√µes abaixo). Voc√™ pode alter√°-la configurando a flag `--port` ao executar ou, no Docker Compose, mudando o mapeamento de porta.
* **Modo Debug:** Em ambiente de desenvolvimento, o **reload autom√°tico** est√° ativado (quando usando uvicorn via `uv run` ou o comando `fastapi dev`). Em produ√ß√£o, certifique-se de desativar o debug e reload para melhor performance.

---

## ‚ñ∂Ô∏è Como executar o projeto localmente

Voc√™ pode executar a aplica√ß√£o localmente de duas formas: diretamente no ambiente Python (ideal para desenvolvimento) ou usando Docker (√∫til para testar em ambiente isolado ou produzir uma imagem de deploy).

### Caminho A ‚Äî **Ambiente local com uv (recomendado)**

1. **Instale a ferramenta `uv` (Gerenciador de ambientes e deps da Astral):**

   * **Linux/macOS (via cURL):**

     ```bash
     curl -LsSf https://astral.sh/uv/install.sh | sh
     ```
   * **Windows (via PowerShell):**

     ```powershell
     iwr https://astral.sh/uv/install.ps1 -UseBasicParsing | iex
     ```

   *Caso prefira, consulte a [documenta√ß√£o oficial do uv](https://github.com/astral-sh/uv) para m√©todos alternativos de instala√ß√£o.*

2. **Clone este reposit√≥rio e navegue at√© a pasta do projeto:**

   ```bash
   git clone https://github.com/BrunoTanabe/fastapi-apikey-authentication.git
   cd fastapi-apikey-authentication
   ```

3. **Crie um ambiente virtual Python:**

   ```bash
   uv venv .venv
   ```

   Isso ir√° criar uma virtualenv chamada `.venv` na raiz do projeto. (Opcionalmente, voc√™ poderia usar `python -m venv .venv` seguido de `source .venv/bin/activate` em vez do comando acima.)

4. **Instale as depend√™ncias de produ√ß√£o:**

   ```bash
   uv sync
   ```

   Esse comando ler√° o `pyproject.toml` e instalar√° todas as depend√™ncias especificadas, respeitando as vers√µes travadas em `uv.lock`. Ao concluir, seu ambiente ter√° FastAPI, Uvicorn e demais pacotes necess√°rios.

5. **(Opcional) Instale tamb√©m as depend√™ncias de desenvolvimento:**

   ```bash
   uv sync --group dev
   ```

   Isso inclui ferramentas como `pytest` e `ruff`. N√£o √© necess√°rio para rodar a aplica√ß√£o, mas √© √∫til para executar testes e manter a qualidade do c√≥digo.

6. **Configure as vari√°veis de ambiente:**

   ```bash
   cp .env.example .env
   ```

   Edite o arquivo `.env` rec√©m-criado inserindo os valores apropriados. Em especial, defina `SECURITY_API_KEY` com uma chave (token) secreta que ser√° necess√°ria para acessar os endpoints da API. Voc√™ pode manter `SECURITY_API_KEY_HEADER` como `X-API-Key` (ou alterar se desejar usar outro cabe√ßalho).

7. **Execute a API em modo desenvolvimento (com *hot-reload*):**

   ```bash
   uv run uvicorn app.app:app --reload --port 8000 --host 0.0.0.0
   ```

   Esse comando inicia o servidor Uvicorn com a aplica√ß√£o FastAPI (indicada por `app.app:app`, ou seja, objeto `app` definido em `app/app.py`), habilita o *reload* autom√°tico a cada mudan√ßa de arquivo, e faz bind na porta 8000 de todos os interfaces de rede (0.0.0.0).

   Alternativamente, voc√™ pode usar o atalho do **FastAPI CLI** (instalado via extra `[standard]`):

   ```bash
   uv run fastapi dev app/app.py --port 8000
   ```

   O resultado final √© o mesmo: sua API estar√° ouvindo em `http://localhost:8000`.

8. **Acesse a documenta√ß√£o interativa** para testar:
   Abra seu navegador em [http://localhost:8000/docs](http://localhost:8000/docs). Voc√™ ver√° a interface Swagger UI onde √© poss√≠vel experimentar os endpoints. Lembre-se de clicar em **Authorize** e fornecer a chave de API definida em seu `.env` para conseguir realizar chamadas protegidas.

> üí° **Dica:** O comando `uv run ...` garante que o lockfile de depend√™ncias esteja sincronizado antes de rodar, evitando ‚Äúsurpresas‚Äù de vers√µes divergentes. Se preferir n√£o usar o `uv`, pode rodar diretamente `uvicorn app.app:app --reload --port 8000` ap√≥s ter instalado as depend√™ncias com `pip install -r requirements.txt`.

---

### Caminho B ‚Äî **Docker / Docker Compose**

Se preferir ou para fins de produ√ß√£o, voc√™ pode executar a aplica√ß√£o dentro de um container Docker:

1. **Certifique-se de ter o Docker instalado** e o daemon em execu√ß√£o em sua m√°quina.

2. **Build da imagem Docker do projeto:**
   No diret√≥rio raiz do projeto, rode:

   ```bash
   docker build -t fastapi-apikey-auth .
   ```

   Isso ir√° utilizar o `Dockerfile` fornecido para empacotar a aplica√ß√£o. O comando acima nomeia a imagem localmente como "fastapi-apikey-auth".

3. **Execute o container da aplica√ß√£o:**

   ```bash
   docker run --rm -p 8000:8000 --env-file .env fastapi-apikey-auth
   ```

   Esse comando:

   * Publica a porta 8000 do container na porta 8000 do host.
   * Carrega as vari√°veis de ambiente do seu arquivo `.env` local para dentro do container (assegurando que a API Key e outras configs sejam conhecidas dentro do container).
   * Usa a imagem que voc√™ buildou no passo anterior.
   * `--rm` garante que o container seja destru√≠do ap√≥s sua finaliza√ß√£o (n√£o ficar√° pendurado no seu Docker).

4. **(Opcional) Use Docker Compose para desenvolvimento:**
   Se quiser simplificar o processo, um arquivo `docker-compose.yaml` √© fornecido. Ele j√° est√° configurado para construir a imagem e expor a porta 8000. Basta rodar:

   ```bash
   docker-compose up --build
   ```

   O servi√ßo `api` j√° mapeia `8000:8000` e monta o diret√≥rio do projeto para refletir mudan√ßas em tempo real. Voc√™ pode editar o `docker-compose.yaml` caso queira customizar (por exemplo, ajustar volumes ou comandos).

5. **Abrir Swagger e testar:**
   Com o container rodando, acesse [http://localhost:8000/docs](http://localhost:8000/docs) para garantir que tudo est√° funcionando dentro do container. As rotas e autentica√ß√£o devem funcionar identicamente ao ambiente local.

> üê≥ **Dica:** A imagem Docker gerada √© baseada em Python slim, contendo apenas as depend√™ncias do projeto (gra√ßas √† instala√ß√£o via `requirements.txt`). Para um tamanho de imagem ainda menor, voc√™ pode usar um builder multi-stage ou imagem base Alpine/Python. Al√©m disso, lembre-se de configurar vari√°veis de ambiente seguras em sistemas de CI/CD ou orquestradores (ao inv√©s de hardcode no Dockerfile).

---

## üîå Endpoints Dispon√≠veis

> Em geral, todas as respostas da API (tanto de sucesso quanto de erro) seguem um formato padr√£o conforme definido pelo schema **`StandardResponse`**. Esse formato inclui campos como `code`, `method`, `path` e `timestamp`, al√©m de um objeto `details` que cont√©m o resultado real ou mensagens de erro. Dessa forma, voc√™ ter√° informa√ß√µes uniformes para logs e tratamento no cliente.

### üîê Autentica√ß√£o

A autentica√ß√£o por API Key funciona da seguinte forma neste projeto:

* Todas as rotas "protegidas" exigem um cabe√ßalho HTTP espec√≠fico, cujo nome padr√£o √© definido em `SECURITY_API_KEY_HEADER` (no arquivo `.env`). Por padr√£o, utilizamos **`X-API-Key`**.
* O valor desse cabe√ßalho deve corresponder √† chave definida na vari√°vel de ambiente `SECURITY_API_KEY`.
* Caso a chave n√£o seja enviada ou esteja incorreta:

  * A API retorna **HTTP 401 Unauthorized**, com um JSON de erro indicando credenciais inv√°lidas.
  * O cabe√ßalho `WWW-Authenticate` ser√° inclu√≠do na resposta, seguindo as recomenda√ß√µes do HTTP para credenciais de API (apesar de n√£o ser um esquema Basic ou Bearer, isso indica ao cliente que a autentica√ß√£o √© necess√°ria).
* Endpoints espec√≠ficos s√£o mantidos abertos (sem necessidade de chave) por design: tipicamente o pr√≥prio Swagger `/docs`, o `/openapi.json` e o health check `/healthz`. Assim, voc√™ pode verificar o status ou documenta√ß√£o da API sem possuir a chave.

### üìã Vis√£o Geral

Abaixo est√£o listados os principais endpoints disponibilizados por este projeto:

| M√©todo   | Rota                   | Descri√ß√£o                                                                                  | Auth | Body (JSON)                  | Sucesso | Erros principais |
|----------|------------------------|--------------------------------------------------------------------------------------------|:----:|------------------------------|:-------:|------------------|
| **POST** | **`/api/v1/example/`** | Endpoint de exemplo que realiza uma opera√ß√£o demonstrativa (p.ex. sauda√ß√£o personalizada). |  ‚úÖ   | Sim (objeto JSON de entrada) |   200   | 401, 422, 500    |
| **GET**  | **`/healthz`**         | Verifica√ß√£o de sa√∫de da aplica√ß√£o (retorna "OK" se ativa).                                 |  ‚ùå   | N/A                          |   200   | 500              |
| **GET**  | **`/`**                | Redireciona para a documenta√ß√£o Swagger UI (`/docs`).                                      |  ‚ùå   | N/A                          |   308   | N/A              |
| **GET**  | **`/docs`**            | Documenta√ß√£o interativa Swagger (OpenAPI UI).                                              |  ‚ùå   | N/A                          |   200   | N/A              |
| **GET**  | **`/redoc`**           | Documenta√ß√£o alternativa ReDoc.                                                            |  ‚ùå   | N/A                          |   200   | N/A              |

*(Auth = precisa de API Key; Body = corpo JSON requerido, se aplic√°vel.)*

---

### 1) POST `/api/v1/example/` ‚Äî **Exemplo de Opera√ß√£o**

<details>
<summary><strong>Detalhes do Endpoint</strong></summary>

**Descri√ß√£o:** Este endpoint ilustrativo recebe uma entrada JSON (por exemplo, contendo um nome) e retorna uma resposta simples (por exemplo, uma mensagem de sauda√ß√£o personalizada). Serve para demonstrar valida√ß√£o de request via Pydantic, a necessidade de autentica√ß√£o para acesso e o formato de resposta padronizado.

* **Exige autentica√ß√£o?** Sim, √© necess√°rio enviar o cabe√ßalho **`X-API-Key`** (ou outro definido em `SECURITY_API_KEY_HEADER`) com a chave correta.

* **Corpo da requisi√ß√£o (JSON):**

  ```json
  {
    "name": "Jo√£o da Silva"
  }
  ```

  * `name` (string): Nome da pessoa a ser saudada. √â um campo obrigat√≥rio, com tamanho m√≠nimo de 1 caracter (valida√ß√£o apenas ilustrativa).

* **Exemplo de resposta com sucesso (HTTP 200):**

  Supondo que o nome enviado seja "Jo√£o da Silva":

  ```json
  {
    "code": 200,
    "method": "POST",
    "path": "/api/v1/example/",
    "timestamp": "2025-07-27T03:15:00Z",
    "details": {
      "message": "Request processed successfully.",
      "data": {
        "greeting": "Hello Jo√£o da Silva!"
      }
    }
  }
  ```

  *Explica√ß√£o:* O campo `details.data.greeting` cont√©m a mensagem gerada a partir do nome fornecido.

* **Poss√≠veis erros (c√≥digos e condi√ß√µes):**

  * `401 Unauthorized`: Se o cabe√ßalho de API Key estiver ausente ou incorreto.
  * `422 Unprocessable Entity`: Se o JSON de entrada n√£o corresponder ao schema esperado (ex: campo obrigat√≥rio faltando, tipo incorreto).
  * `500 Internal Server Error`: Para falhas inesperadas no processamento (ex.: exce√ß√£o n√£o tratada).

* **Exemplo de resposta de erro (API Key ausente ou inv√°lida ‚Äì HTTP 401):**

  ```json
  {
    "code": 401,
    "method": "POST",
    "path": "/api/v1/example/",
    "timestamp": "2025-07-27T03:15:00Z",
    "details": {
      "message": "Authentication failed.",
      "data": {
        "error": "Invalid or missing API key."
      }
    }
  }
  ```

* **Exemplo de resposta de erro (valida√ß√£o ‚Äì HTTP 422):**

  ```json
  {
    "code": 422,
    "method": "POST",
    "path": "/api/v1/example/",
    "timestamp": "2025-07-27T03:15:00Z",
    "details": {
      "message": "Validation error.",
      "data": {
        "name": "Field required"
      }
    }
  }
  ```

  *Obs.:* A estrutura interna de detalhes de valida√ß√£o pode variar conforme as configura√ß√µes do Pydantic/FastAPI. Mas o schema padr√£o do projeto envelopa a resposta de erro em `StandardResponse` tamb√©m.

* **Dica de teste r√°pido:** Voc√™ pode usar o `curl` para testar este endpoint (substitua `<SUACHAVE>` pela chave definida no .env):

  ```bash
  curl -X POST "http://localhost:8000/api/v1/example/" \
    -H "Content-Type: application/json" \
    -H "X-API-Key: <SUACHAVE>" \
    -d '{"name": "Jo√£o da Silva"}'
  ```

</details>

---

### 2) GET `/healthz` ‚Äî **Health Check**

<details>
<summary><strong>Detalhes do Endpoint</strong></summary>

**Descri√ß√£o:** Endpoint de monitoramento simples que retorna o status de sa√∫de da aplica√ß√£o. √ötil para check-ups automatizados (por exemplo, utilizados pelo Kubernetes, AWS ELB ou outras ferramentas de monitoramento para verificar se a aplica√ß√£o est√° viva).

* **Requer autentica√ß√£o?** N√£o. Este endpoint √© p√∫blico por design, j√° que costuma ser acessado por servi√ßos de orquestra√ß√£o que n√£o possuem credenciais.
* **Corpo da requisi√ß√£o:** N/A (nada √© enviado al√©m da requisi√ß√£o GET).
* **Exemplo de resposta (HTTP 200):**

  ```json
  {
    "code": 200,
    "method": "GET",
    "path": "/healthz",
    "timestamp": "2025-07-27T03:15:00Z",
    "details": {
      "message": "Request processed successfully.",
      "data": {
        "status": "ok"
      }
    }
  }
  ```

  Aqui `details.data.status` indica que o servi√ßo est√° operacional. Poderiam ser adicionados outros campos (ex.: vers√£o da aplica√ß√£o, timestamp do build, etc.), caso desejado.
* **Poss√≠veis erros:**

  * `500 Internal Server Error`: Em situa√ß√µes raras, se algo impedisse at√© mesmo o retorno do status. Normalmente, se a aplica√ß√£o est√° de p√© para responder, dificilmente retornar√° 500 neste endpoint.

</details>

---

### 3) GET `/` ‚Äî **Redirect para `/docs`**

<details>
<summary><strong>Detalhes do Endpoint</strong></summary>

**Descri√ß√£o:** Endpoint raiz (root) da aplica√ß√£o. Ao inv√©s de retornar um conte√∫do pr√≥prio, ele automaticamente redireciona o cliente para a p√°gina de documenta√ß√£o Swagger UI (`/docs`).

* **Requer autentica√ß√£o?** N√£o. Qualquer um que acessar a raiz ser√° redirecionado (e mesmo a p√°gina de docs n√£o precisa de autentica√ß√£o para ser visualizada).
* **Comportamento:** O redirecionamento utilizado √© o **HTTP 308 Permanent Redirect**, o que significa que:

  * O m√©todo HTTP original √© mantido (se algu√©m fizesse um POST em `/`, seria redirecionado para um POST em `/docs` ‚Äì embora esse caso de uso n√£o fa√ßa sentido pr√°tico).
  * Clients e caches podem guardar esse redirecionamento de forma permanente.
* **Exemplo de resposta (HTTP 308):**

  ```json
  {
    "code": 308,
    "method": "GET",
    "path": "/",
    "timestamp": "2025-07-27T03:15:00Z",
    "details": {
      "message": "Redirecting to documentation.",
      "data": {
        "url": "/docs"
      }
    }
  }
  ```

  Note que, al√©m do corpo acima, o cabe√ßalho `Location: /docs` √© enviado, conforme exigido pelo padr√£o HTTP para redirecionamentos.
* Depois de redirecionado, o cliente ver√° a interface Swagger UI em funcionamento (podendo ent√£o interagir com a API a partir de l√°).

</details>

---

### 4) GET `/docs` & `/redoc` ‚Äî **Documenta√ß√£o**

<details>
<summary><strong>Detalhes do Endpoint</strong></summary>

**Descri√ß√£o:** FastAPI fornece automaticamente duas interfaces de documenta√ß√£o:

* **`/docs`**: Interface do **Swagger UI**, permitindo navegar pelos endpoints, ver schemas de entrada/sa√≠da e executar chamadas diretamente pelo navegador (via *Try it out*).
* **`/redoc`**: Interface do **ReDoc**, que √© uma documenta√ß√£o est√°tica e limpa baseada apenas no schema OpenAPI (tamb√©m √∫til para compartilhar docs read-only).

- **Requer autentica√ß√£o?** N√£o para visualizar a documenta√ß√£o. Entretanto, para testar os endpoints protegidos via Swagger UI, voc√™ precisar√° fornecer a API Key usando o bot√£o **Authorize** (o Swagger UI exibir√° um campo para a chave, com o nome do header definido).
- **Uso pr√°tico:** Utilize `/docs` durante o desenvolvimento para experimentar rapidamente chamadas. Em ambientes de produ√ß√£o, considere desabilitar ou proteger essa rota (via configura√ß√µes do FastAPI ou at√© colocando-a atr√°s de autentica√ß√£o b√°sica no servidor web), caso n√£o queira que a documenta√ß√£o fique exposta publicamente.
- **Exemplo de visualiza√ß√£o:** A interface do Swagger UI √© semelhante a:
  ![Swagger UI Screenshot](https://fastapi.tiangolo.com/img/index/index-01-swagger-ui-simple.png)
  *(Nota: imagem ilustrativa da documenta√ß√£o do FastAPI, a apar√™ncia real incluir√° seus endpoints e modelos).*

</details>

---

## ‚ùì Perguntas Frequentes (FAQ)

**1. Qual √© o nome do header da API Key e posso alter√°-lo?**
Por padr√£o, utilizamos o cabe√ßalho **`X-API-Key`**, definido na vari√°vel de ambiente `SECURITY_API_KEY_HEADER`. Voc√™ pode alter√°-lo editando o valor dessa vari√°vel (tanto no `.env` quanto no ambiente de produ√ß√£o). Lembre-se de que os clientes que consumir√£o a API precisam conhecer esse nome tamb√©m.

**2. Como gero ou obtenho a API Key?**
Esta √© uma escolha de implementa√ß√£o. Neste projeto de exemplo, a chave √© definida manualmente via vari√°vel de ambiente (`SECURITY_API_KEY`). Ou seja, voc√™ pode escolher um token secreto (uma string aleat√≥ria longa, por exemplo) e configur√°-lo como a chave aceita. Em cen√°rios mais complexos, voc√™ poderia integrar com um banco de dados ou um servi√ßo de gerenciamento de credenciais para validar m√∫ltiplas API Keys, mas isso foge do escopo deste template simples.

**3. Recebo 401 Unauthorized ao chamar um endpoint, mesmo enviando o header. Por qu√™?**
Certifique-se de que:
a) Voc√™ est√° usando o **nome exato** do cabe√ßalho configurado (por exemplo, `X-API-Key` respeitando mai√∫sculas/min√∫sculas).
b) Voc√™ definiu a vari√°vel `SECURITY_API_KEY` corretamente e est√° usando o **mesmo valor** na requisi√ß√£o.
c) N√£o h√° espa√ßos ou caracteres extras inadvertidos na chave enviada.
Se tudo isso estiver correto e ainda receber 401, confira os logs da aplica√ß√£o: possivelmente a chave est√° incorreta ou n√£o est√° sendo enviada no header esperado.

**4. O que acontece se eu n√£o fornecer a API Key nos endpoints protegidos?**
A requisi√ß√£o ser√° **rejeitada imediatamente** com status 401 (Unauthorized). A l√≥gica do FastAPI via depend√™ncia de seguran√ßa impede que a fun√ß√£o do endpoint seja executada. Ent√£o, √© fundamental configurar seus clientes HTTP para sempre enviarem o cabe√ßalho exigido.

**5. Posso tornar o endpoint `/docs` tamb√©m protegido por API Key?**
Sim, √© poss√≠vel. Por padr√£o, deixamos aberto para facilitar o desenvolvimento. Mas se voc√™ quiser restringir, pode desabilitar o Swagger UI (configurando `docs_url=None` na inicializa√ß√£o do FastAPI) ou implementar uma prote√ß√£o condicional. Uma forma simples √© adicionar a mesma depend√™ncia de `APIKeyHeader` no router do docs, embora isso exija sobrescrever a rota gerada automaticamente pelo FastAPI.

**6. Como adicionar novos endpoints ou m√≥dulos ao projeto?**
Voc√™ pode criar um novo diret√≥rio em `app/modules` seguindo a estrutura dos m√≥dulos existentes (domain, application, presentation). No m√≠nimo, crie um `routers.py` dentro de `presentation` definindo suas rotas FastAPI. Depois, inclua o router no `app/app.py`. Utilize o m√≥dulo **example** como refer√™ncia de como separar l√≥gica (caso necess√°rio) e schemas.

**7. Como executar os testes automatizados?**
Ap√≥s instalar as depend√™ncias de dev (`uv sync --group dev` ou similar), voc√™ pode rodar `pytest`. Por exemplo:

```bash
uv run pytest -q
```

Isso ir√° procurar na pasta `test/` por testes. Inicialmente, podem haver apenas casos b√°sicos ou nenhum teste concreto, dado que este √© um template. √Ä medida que voc√™ adicionar funcionalidades, crie arquivos de teste correspondentes para garantir que tudo continue funcionando conforme esperado.

**8. Este template suporta autentica√ß√£o por usu√°rios (login/senha) ou apenas API Key?**
Nativamente, apenas API Key. O foco aqui √© mostrar uma maneira simples de proteger toda uma API que √© consumida por sistemas de backend ou parceiros (onde voc√™ pode fornecer uma chave secreta para eles). Se voc√™ precisa de autentica√ß√£o de usu√°rio final (login), ser√° necess√°rio implementar um mecanismo adicional (como OAuth2 Password Flow com JWT, que o pr√≥prio FastAPI suporta bem, mas isso est√° fora do escopo deste projeto de exemplo).

**9. Qual √© o pr√≥ximo passo se eu quiser usar este projeto em produ√ß√£o?**
Algumas recomenda√ß√µes:

* Gere uma chave de API bem forte e distribua com cuidado para os clientes que precisar√£o consumir a API.
* Habilite HTTPS no tr√°fego para proteger a chave em tr√¢nsito (isto √© normalmente feito no n√≠vel do servidor ou do proxy reverso, j√° que o Uvicorn/Hypercorn em si n√£o lida com certificados diretamente).
* Ajuste os par√¢metros de configura√ß√£o no `.env` para produ√ß√£o (por exemplo, n√≠veis de log menos verbosos, desabilitar reload, etc.).
* Opcionalmente, configure um mecanismo de rota√ß√£o de chaves se precisar invalidar/atualizar a chave sem downtime (pode envolver ler m√∫ltiplas chaves v√°lidas de uma fonte externa ou arquivo, em vez de uma √∫nica do .env).
* Inclua monitoramento e logging centralizado: os logs em JSON do Loguru podem ser enviados para seu aggregator preferido, e o endpoint de health pode ser monitorado periodicamente.

**10. Existe suporte a CORS (Cross-Origin Resource Sharing) nesse projeto?**
Atualmente, n√£o h√° configura√ß√£o expl√≠cita de CORS. O FastAPI por padr√£o n√£o habilita CORS automaticamente. Se voc√™ planeja que essa API seja consumida via browsers (diferente do mesmo dom√≠nio), √© preciso habilitar CORS manualmente. Isso pode ser feito adicionando um middleware:

```python
from fastapi.middleware.cors import CORSMiddleware
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],  # Ajuste para os dom√≠nios apropriados em produ√ß√£o
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

Coloque isso em `app/app.py` antes de iniciar a aplica√ß√£o. No entanto, tenha em mente que se sua API √© apenas de uso interno (server-to-server), CORS pode n√£o ser necess√°rio.

---

## ü§ù Como contribuir

Contribui√ß√µes s√£o bem-vindas! Se voc√™ tem ideias para melhorar este template (como adicionar novas funcionalidades, corrigir bugs ou melhorar documenta√ß√£o), fique √† vontade para abrir *Issues* ou enviar *Pull Requests*. Por favor, siga as orienta√ß√µes abaixo para manter a consist√™ncia do projeto:

### üöÄ Fluxo de contribui√ß√£o

1. **Fa√ßa um *fork*** deste reposit√≥rio para a sua conta no GitHub.
2. **Clone o seu fork** para a sua m√°quina local:

   ```bash
   git clone https://github.com/seuusuario/fastapi-apikey-authentication.git
   ```

   e adicione o reposit√≥rio original como `upstream`:

   ```bash
   git remote add upstream https://github.com/BrunoTanabe/fastapi-apikey-authentication.git
   ```
3. **Crie uma *branch* para sua contribui√ß√£o**:

   ```bash
   git checkout -b feat/nome-da-sua-feature
   ```

   Use um nome descritivo que reflete a mudan√ßa proposta (ex: `feat/multiple-api-keys` ou `fix/header-typo`).
4. **Prepare o ambiente de desenvolvimento** seguindo os passos da se√ß√£o *Como executar o projeto localmente* (incluindo `uv sync --group dev` para ter `pytest` e `ruff`).
5. **Implemente sua mudan√ßa** com c√≥digo claro e coment√°rios se necess√°rio.
6. **Teste localmente**: assegure-se de rodar `pytest` para verificar que todos os testes passam (e preferencialmente, adicione testes para sua nova funcionalidade ou corre√ß√£o).
7. **Formate/Linte o c√≥digo** antes de commitar:

   ```bash
   uv run ruff format
   uv run ruff check --fix
   ```

   Isso vai aplicar formata√ß√µes autom√°ticas e corrigir problemas de lint sempre que poss√≠vel.
8. **Commit e push**:

   ```bash
   git add .
   git commit -m "feat: Sua mensagem de commit seguindo conven√ß√µes"
   git push origin feat/nome-da-sua-feature
   ```

   Tente seguir o padr√£o de *Conventional Commits* na mensagem (veja abaixo).
9. **Abra um Pull Request (PR)** no GitHub, direcionando do seu reposit√≥rio/branch para o `main` deste reposit√≥rio. Preencha a descri√ß√£o do PR explicando o que foi feito, por qu√™, e qualquer detalhe necess√°rio para avaliar.
10. **Acompanhe o code review**: pode ser que haja feedback ou sugest√µes. Fique atento √†s coment√°rios no seu PR e responda/ou fa√ßa ajustes conforme solicitado.
11. **Merge**: uma vez aprovado, seu PR ser√° integrado. Voc√™ pode ent√£o deletar sua branch local e no fork, se desejar.

### üß≠ Padr√µes de Branches & Commits

* Nomeie as *branches* de forma consistente:

  * **feat/** para novas funcionalidades.
  * **fix/** para corre√ß√µes de bugs.
  * **docs/** para melhorias apenas de documenta√ß√£o.
  * **refactor/**, **test/**, **chore/**, etc., para outros tipos de mudan√ßa espec√≠ficos.
  * Exemplo: `feat/support-multiple-keys`, `fix/api-key-case-sensitive`.
* Utilize mensagens de commit no formato *Conventional Commits*. Alguns exemplos:

  * `feat: suporte a m√∫ltiplas API Keys por usu√°rio`
  * `fix: corrige valida√ß√£o do cabe√ßalho quando ausente`
  * `docs: melhora explica√ß√£o sobre uso do endpoint /healthz`
  * Inclua um escopo entre par√™nteses se desejar (ex: `feat(example): adiciona novo campo no payload do endpoint X`).

Manter esse padr√£o ajuda a gerar um **CHANGELOG** e vers√µes (tag sem√¢ntica) mais facilmente no futuro.

### üßπ Qualidade de C√≥digo & Estilo

Este projeto adota as boas pr√°ticas recomendadas para Python:

* **Linting/Formata√ß√£o**: Use o Ruff para manter o c√≥digo padronizado. J√° est√° configurado para aplicar regras do Flake8, isort, e formatar c√≥digo no estilo do Black. Execute `ruff check` regularmente e antes de commitar, para evitar problemas de estilo.
* **Tipagem**: Sempre que poss√≠vel, inclua tipos est√°ticos nas fun√ß√µes e classes. O Python n√£o √© estritamente tipado em runtime, mas tipos ajudam na manuten√ß√£o e integra√ß√£o com IDEs.
* **Docstrings**: Sinta-se livre para adicionar docstrings explicativos nas fun√ß√µes m√©todos complexos. Especialmente se introduzir um m√©todo p√∫blico numa classe, pode ser √∫til descrever o comportamento esperado.
* **Organiza√ß√£o**: Tente seguir a conven√ß√£o de manter fun√ß√µes/m√©todos curtos e coesos. Se um trecho de c√≥digo ficar muito longo ou complexo, avalie refatorar em fun√ß√µes auxiliares.

### üîê Vari√°veis de Ambiente & Segredos

* **N√£o compartilhe segredos nos commits**: certifique-se de que nunca vai commitar seu arquivo `.env` com chaves sens√≠veis reais. O `.gitignore` j√° est√° configurado para ignor√°-lo. Se precisar adicionar um exemplo, use o `.env.example`.
* **Segredos em PRs p√∫blicos**: Caso fa√ßa um fork (p√∫blico) e queira executar o pipeline CI no seu PR, cuide para usar segredos ap√≥s integrados no reposit√≥rio e n√£o expor nada sens√≠vel. (No caso deste template, n√£o h√° muitos segredos exceto a pr√≥pria API Key, que voc√™ controlar√° localmente.)

### üîÑ Pull Requests (PRs)

* **Escopo**: Foque cada PR em uma √∫nica finalidade. Evite enviar um PR gigantesco que fa√ßa v√°rias coisas distintas; √© melhor separar em v√°rios PRs menores, mais f√°ceis de revisar.
* **Descri√ß√£o**: Ao abrir o PR, d√™ contexto do problema e da solu√ß√£o. Se houver *issue* relacionada, mencione (e.g. "Closes #10").
* **CI/CD**: Caso o reposit√≥rio tenha integra√ß√µes de CI (por ex., testes automatizados rodando via GitHub Actions), aguarde e verifique se tudo passou. Resolva quaisquer problemas apontados antes da revis√£o (isso inclui erros de lint ou testes falhando).
* **Discuss√£o**: Se voc√™ n√£o tem certeza sobre a abordagem da sua solu√ß√£o, √© v√°lido abrir primeiro uma *issue* para discutir, ou abrir um PR como *draft* (rascunho) pedindo feedback.

### ‚úÖ Checklist antes de abrir o PR

Reveja se voc√™ marcou todas as caixas:

* [ ] Testes escritos/atualizados para cobrir a mudan√ßa (quando aplic√°vel).
* [ ] Todos os testes est√£o passando (`pytest`).
* [ ] Lint/format aplicado (c√≥digo segue padr√£o do projeto).
* [ ] Documenta√ß√£o atualizada (README.md, docstrings, exemplos).
* [ ] Descri√ß√£o do PR preenchida informando o porqu√™ da mudan√ßa e o que foi feito.
* [ ] Commits organizados e com mensagens significativas.

---

## üìú Licen√ßa

Este projeto √© distribu√≠do sob a licen√ßa **MIT**. Isso significa que voc√™ √© livre para usar, modificar e distribuir este c√≥digo, desde que mantenha o aviso de copyright original. Consulte o arquivo [LICENSE](LICENSE) para mais detalhes.

## üë• Autores

**Bruno Tanabe** ‚Äì *Criador e Maintainer* ‚Äì [GitHub](https://github.com/BrunoTanabe) | [LinkedIn](https://www.linkedin.com/in/tanabebruno/)
Apresentei este template com o intuito de ajudar outros desenvolvedores a iniciarem projetos FastAPI de forma organizada e segura. Se voc√™ tiver sugest√µes ou encontrar problemas, sinta-se livre para contribuir!
